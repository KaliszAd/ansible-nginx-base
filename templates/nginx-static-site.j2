# This file is generated automagically. Don't change, your changes will be overwrittern
#
# {{ ansible_managed }}
#

# {{ item.host }}

server {
        listen 443 ssl;
        server_name {{ item.host }};
        access_log  /var/log/nginx/{{item.host}}-access_log main;

{% if item.request_acme_cert %}
        ssl_certificate      /etc/pki/acme/{{ item.host }}/fullchain.pem;
        ssl_certificate_key  /etc/pki/acme/{{ item.host }}/key.pem;
{% else %}
        ssl_certificate      /etc/pki/nginx/{{ item.host }}/cert.pem
        ssl_certificate_key  /etc/pki/nginx/{{ item.host }}/key.pem;
{% endif %}


        ssl_session_cache shared:SSL:1m;
        ssl_session_timeout  5m;

        ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';
        ssl_dhparam /etc/nginx/dhparams.pem;

{% if nginx_host_passwd_file %}
        # protected location
{% endif %}
{% if item.root_config|default(None) %}
        # Using custom root_config
{{ item.root_config }}
        # end of custom root_config
{% else %}
        location / {
{% if 'http_basic_auth' in item %}
                proxy_set_header X-Forwarded-User $remote_user;
{% endif %}
                root /var/www/{{ item.host }}/;
                client_max_body_size    128m;
{% if 'http_basic_auth' in item %}
                auth_basic "{{ item.host }} password required";
                auth_basic_user_file {{nginx_host_passwd_file}};
{% endif %}
        }
{% endif %}
}
# {{ ansible_managed }}
